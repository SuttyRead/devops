#apiVersion: v1
#kind: Namespace
#metadata:
#  name: authentik
#
#---
#
#apiVersion: v1
#kind: Service
#metadata:
#  name: authentik-postgresql
#  namespace: authentik
#spec:
#  ports:
#    - port: 5432
#  selector:
#    app: authentik-postgresql
#
#---
#
#apiVersion: apps/v1
#kind: Deployment
#metadata:
#  name: authentik-postgresql
#  namespace: authentik
#spec:
#  selector:
#    matchLabels:
#      app: authentik-postgresql
#  template:
#    metadata:
#      labels:
#        app: authentik-postgresql
#    spec:
#      containers:
#        - name: postgresql
#          image: postgres:13
#          env:
#            - name: POSTGRES_DB
#              value: authentik
#            - name: POSTGRES_USER
#              value: authentik
#            - name: POSTGRES_PASSWORD
#              value: yourpassword
#          ports:
#            - containerPort: 5432
#          volumeMounts:
#            - mountPath: /var/lib/postgresql/data
#              name: postgresql-data
#      volumes:
#        - name: postgresql-data
#          persistentVolumeClaim:
#            claimName: authentik-postgresql-pvc
#
#---
#
#apiVersion: v1
#kind: PersistentVolumeClaim
#metadata:
#  name: authentik-postgresql-pvc
#  namespace: authentik
#spec:
#  accessModes:
#    - ReadWriteOnce
#  resources:
#    requests:
#      storage: 5Gi
#
#---
#
#apiVersion: v1
#kind: Service
#metadata:
#  name: authentik
#  namespace: authentik
#spec:
#  type: ClusterIP
#  ports:
#    - name: http
#      port: 80
#      targetPort: http
#    - name: https
#      port: 443
#      targetPort: https
#  selector:
#    app: authentik
#
#---
#
#apiVersion: apps/v1
#kind: Deployment
#metadata:
#  name: authentik
#  namespace: authentik
#spec:
#  replicas: 1
#  selector:
#    matchLabels:
#      app: authentik
#  template:
#    metadata:
#      labels:
#        app: authentik
#    spec:
#      containers:
#        - name: authentik
#          image: goauthentik.io/authentik:2023.1
#          env:
#            - name: AUTHENTIK_POSTGRESQL__HOST
#              value: authentik-postgresql
#            - name: AUTHENTIK_POSTGRESQL__NAME
#              value: authentik
#            - name: AUTHENTIK_POSTGRESQL__USER
#              value: authentik
#            - name: AUTHENTIK_POSTGRESQL__PASSWORD
#              value: yourpassword
#          ports:
#            - name: http
#              containerPort: 80
#            - name: https
#              containerPort: 443
#
#---
#
#apiVersion: networking.k8s.io/v1
#kind: Ingress
#metadata:
#  name: authentik-ingress
#  namespace: authentik
#  annotations:
#    kubernetes.io/ingress.class: "traefik"
#    cert-manager.io/cluster-issuer: "letsencrypt-staging"
#    traefik.ingress.kubernetes.io/router.entrypoints: websecure
#spec:
#  tls:
#    - hosts:
#        - authentik.suttyread.link
#      secretName: authentik-tls
#  rules:
#    - host: authentik.suttyread.link
#      http:
#        paths:
#          - path: /
#            pathType: Prefix
#            backend:
#              service:
#                name: authentik
#                port:
#                  number: 80
#
