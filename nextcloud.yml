#apiVersion: v1
#kind: Namespace
#metadata:
#  name: nextcloud
#
#---
#
#apiVersion: apps/v1
#kind: Deployment
#metadata:
#  name: nextcloud
#  namespace: nextcloud
#spec:
#  replicas: 1
#  selector:
#    matchLabels:
#      app: nextcloud
#  template:
#    metadata:
#      labels:
#        app: nextcloud
#    spec:
#      containers:
#        - name: nextcloud
#          image: nextcloud:stable
#          ports:
#            - containerPort: 80
#          env:
#            - name: MYSQL_PASSWORD
#              value: YOUR_SECRET
#            - name: MYSQL_DATABASE
#              value: nextcloud
#            - name: MYSQL_USER
#              value: nextcloud
#            - name: MYSQL_HOST
#              value: nextcloud-db
#            - name: NEXTCLOUD_ADMIN_USER
#              value: suttyread
#            - name: NEXTCLOUD_ADMIN_PASSWORD
#              value: suttyread
#            - name: OVERWRITEHOST
#              value: nextcloud.sutty.shop
#            - name: OVERWRITEPROTOCOL
#              value: https
#          volumeMounts:
#            - name: nextcloud-data-storage
#              mountPath: /var/www/html
#      volumes:
#        - name: nextcloud-data-storage
#          persistentVolumeClaim:
#            claimName: nextcloud-data-pvc
#
#---
#
#apiVersion: v1
#kind: Service
#metadata:
#  name: nextcloud
#  namespace: nextcloud
#spec:
#  selector:
#    app: nextcloud
#  ports:
#    - protocol: TCP
#      port: 80
#      targetPort: 80
#
#---
#
#apiVersion: networking.k8s.io/v1
#kind: Ingress
#metadata:
#  name: nextcloud-ingress
#  namespace: nextcloud
#  annotations:
#    traefik.ingress.kubernetes.io/router.entrypoints: web,websecure
#    kubernetes.io/ingress.class: traefik
#    cert-manager.io/cluster-issuer: "letsencrypt-staging"
#spec:
#  tls:
#    - hosts:
#        - nextcloud.sutty.shop
#      secretName: app-tls
#  rules:
#    - host: "nextcloud.sutty.shop"
#      http:
#        paths:
#          - path: /
#            pathType: Prefix
#            backend:
#              service:
#                name: nextcloud
#                port:
#                  number: 80
#
#---
#
#apiVersion: v1
#kind: PersistentVolumeClaim
#metadata:
#  name: nextcloud-data-pvc
#  namespace: nextcloud
#spec:
#  accessModes:
#    - ReadWriteOnce
#  resources:
#    requests:
#      storage: 100Gi
#
#---
#
#apiVersion: apps/v1
#kind: Deployment
#metadata:
#  name: nextcloud-db
#  namespace: nextcloud
#spec:
#  replicas: 1
#  selector:
#    matchLabels:
#      app: nextcloud-db
#  template:
#    metadata:
#      labels:
#        app: nextcloud-db
#    spec:
#      containers:
#        - name: mysql
#          image: mysql:5.7
#          ports:
#            - containerPort: 3306
#          env:
#            - name: MYSQL_ROOT_PASSWORD
#              value: YOUR_SECRET
#            - name: MYSQL_PASSWORD
#              value: YOUR_SECRET
#            - name: MYSQL_DATABASE
#              value: nextcloud
#            - name: MYSQL_USER
#              value: nextcloud
#          volumeMounts:
#            - name: mysql-db-storage
#              mountPath: /var/lib/mysql
#      volumes:
#        - name: mysql-db-storage
#          persistentVolumeClaim:
#            claimName: nextcloud-db-pvc
#
#---
#
#apiVersion: v1
#kind: PersistentVolumeClaim
#metadata:
#  name: nextcloud-db-pvc
#  namespace: nextcloud
#spec:
#  accessModes:
#    - ReadWriteOnce
#  resources:
#    requests:
#      storage: 10Gi
#
#---
#
#apiVersion: v1
#kind: Service
#metadata:
#  name: nextcloud-db
#  namespace: nextcloud
#spec:
#  selector:
#    app: nextcloud-db
#  ports:
#    - protocol: TCP
#      port: 3306
#      targetPort: 3306
