#apiVersion: v1
#kind: Namespace
#metadata:
#  name: gitlab
#
#---
#
#apiVersion: v1
#kind: PersistentVolumeClaim
#metadata:
#  name: gitlab-data
#  namespace: gitlab
#spec:
#  accessModes:
#    - ReadWriteOnce
#  resources:
#    requests:
#      storage: 10Gi
#
#---
#
#apiVersion: v1
#kind: PersistentVolumeClaim
#metadata:
#  name: postgresql-data
#  namespace: gitlab
#spec:
#  accessModes:
#    - ReadWriteOnce
#  resources:
#    requests:
#      storage: 5Gi
#
#---
#
#apiVersion: v1
#kind: PersistentVolumeClaim
#metadata:
#  name: redis-data
#  namespace: gitlab
#spec:
#  accessModes:
#    - ReadWriteOnce
#  resources:
#    requests:
#      storage: 2Gi
#
#---
#
#apiVersion: apps/v1
#kind: Deployment
#metadata:
#  name: gitlab-ce-deployment
#  namespace: gitlab
#spec:
#  replicas: 1
#  selector:
#    matchLabels:
#      app: gitlab-ce
#  template:
#    metadata:
#      labels:
#        app: gitlab-ce
#    spec:
#      containers:
#        - name: gitlab-ce
#          image: gitlab/gitlab-ce:latest
#          ports:
#            - containerPort: 80
#          env:
#            - name: GITLAB_OMNIBUS_CONFIG
#              value: |
#                external_url 'http://gitlab.suttyread.link'
##                registry_external_url 'http://registry.gitlab.suttyread.link'
##                gitlab_rails['gitlab_shell_ssh_port'] = 22
#          volumeMounts:
#            - mountPath: /etc/gitlab
#              name: gitlab-config
#            - mountPath: /var/opt/gitlab
#              name: gitlab-data
#            - mountPath: /var/opt/gitlab/postgresql
#              name: postgresql-data
#            - mountPath: /var/opt/gitlab/redis
#              name: redis-data
#      volumes:
#        - name: gitlab-config
#          emptyDir: {}
#        - name: gitlab-data
#          persistentVolumeClaim:
#            claimName: gitlab-data
#        - name: postgresql-data
#          persistentVolumeClaim:
#            claimName: postgresql-data
#        - name: redis-data
#          persistentVolumeClaim:
#            claimName: redis-data
#
#---
#
#apiVersion: v1
#kind: Service
#metadata:
#  name: gitlab-ce-service
#  namespace: gitlab
#spec:
#  selector:
#    app: gitlab-ce
#  ports:
#    - name: http
#      protocol: TCP
#      port: 80
#      targetPort: 80
#
#---
#
#apiVersion: networking.k8s.io/v1
#kind: Ingress
#metadata:
#  name: gitlab-ce-ingress
#  namespace: gitlab
#  annotations:
#    kubernetes.io/ingress.class: traefik
#    cert-manager.io/cluster-issuer: "letsencrypt-prod"
#spec:
#  tls:
#    - hosts:
#        - gitlab.suttyread.link
#      secretName: app-tls
#  rules:
#    - host: gitlab.suttyread.link
#      http:
#        paths:
#          - pathType: Prefix
#            path: "/"
#            backend:
#              service:
#                name: gitlab-ce-service
#                port:
#                  number: 80
#
#---
#
#---
#apiVersion: v1
#kind: Service
#metadata:
#  name: gitlab-registry-service
#  namespace: gitlab
#spec:
#  selector:
#    app: gitlab-ce
#  ports:
#    - name: registry
#      protocol: TCP
#      port: 5000
#      targetPort: 5000
#
#---
#
#apiVersion: networking.k8s.io/v1
#kind: Ingress
#metadata:
#  name: gitlab-registry-ingress
#  namespace: gitlab
#  annotations:
#    kubernetes.io/ingress.class: traefik
#    cert-manager.io/cluster-issuer: "letsencrypt-prod"
#spec:
#  tls:
#    - hosts:
#        - registry.gitlab.suttyread.link
#      secretName: registry-app-tls
#  rules:
#    - host: registry.gitlab.suttyread.link
#      http:
#        paths:
#          - pathType: Prefix
#            path: "/"
#            backend:
#              service:
#                name: gitlab-registry-service
#                port:
#                  number: 5000
#
##---
##
##apiVersion: rbac.authorization.k8s.io/v1
##kind: ClusterRole
##metadata:
##  name: gitlab-prometheus
##rules:
##  - apiGroups: [""]
##    resources: ["pods"]
##    verbs: ["get", "list", "watch"]
##
##---
##
##apiVersion: rbac.authorization.k8s.io/v1
##kind: ClusterRoleBinding
##metadata:
##  name: gitlab-prometheus
##subjects:
##  - kind: ServiceAccount
##    name: default
##    namespace: gitlab
##roleRef:
##  kind: ClusterRole
##  name: gitlab-prometheus
##  apiGroup: rbac.authorization.k8s.io
#
#
## gitlab-rake 'gitlab:password:reset[root]'