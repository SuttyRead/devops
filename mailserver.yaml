#apiVersion: v1
#kind: Namespace
#metadata:
#  name: mailserver
#
#---
#
#apiVersion: v1
#kind: ConfigMap
#metadata:
#  name: mailserver.environment
#  namespace: mailserver
#data:
#  TLS_LEVEL: "modern"
#
#---
#
#apiVersion: v1
#kind: PersistentVolumeClaim
#metadata:
#  name: mail-data
#  namespace: mailserver
#spec:
#  storageClassName: "local-path"
#  accessModes:
#    - ReadWriteOnce
#  resources:
#    requests:
#      storage: 25Gi
#
#---
#
#apiVersion: v1
#kind: Service
#metadata:
#  name: mailserver-service
#  namespace: mailserver
#spec:
#  type: LoadBalancer
#  selector:
#    app: mailserver
#  ports:
#    - name: smtp
#      port: 25
#      targetPort: 25
#
#---
#
#apiVersion: apps/v1
#kind: Deployment
#metadata:
#  name: mailserver-deployment
#  namespace: mailserver
#spec:
#  replicas: 1
#  selector:
#    matchLabels:
#      app: mailserver
#  template:
#    metadata:
#      labels:
#        app: mailserver
#    spec:
#      volumes:
#        - name: mail-data
#          persistentVolumeClaim:
#            claimName: mail-data
#      containers:
#        - name: mailserver
#          image: docker-mailserver/docker-mailserver:latest
#          ports:
#            - containerPort: 25
#          volumeMounts:
#            - name: mail-data
#              mountPath: "/var/mail"
#          envFrom:
#            - configMapRef:
#                name: mailserver.environment
#
#---
#
#apiVersion: networking.k8s.io/v1
#kind: Ingress
#metadata:
#  name: mailserver-ingress
#  namespace: mailserver
#  annotations:
#    kubernetes.io/ingress.class: "traefik"
#    cert-manager.io/cluster-issuer: "letsencrypt-staging"
#spec:
#  rules:
#    - host: mail.suttyread.link
#      http:
#        paths:
#          - pathType: Prefix
#            path: "/"
#            backend:
#              service:
#                name: mailserver-service
#                port:
#                  number: 25
#  tls:
#    - hosts:
#        - mail.suttyread.link
#      secretName: mail-tls
